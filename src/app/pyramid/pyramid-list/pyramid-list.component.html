<h1>Pyramid Index</h1>
<p-toast position="top-center"></p-toast>
<div class="flex-column align-content-center"> 
    <div class="flex flex-row align-items-start justify-content-around">
        <div class="w-6rem"></div>
        <p-table [value]="pyramids" class="flex-2" [loading]="loading">
            <ng-template pTemplate="header">
                <tr>
                    <th></th>
                    <th>A1</th>
                    <th>A2</th>
                    <th>B1</th>
                    <th>B2</th>
                    <th>B3</th>
                    <th>C1</th>
                    <th>C2</th>
                    <th>C3</th>
                    <th>D1</th>
                    <th>D2</th>
                </tr>
            </ng-template>
            <ng-template pTemplate="body" let-pyramid  let-rowIndex="rowIndex">
                <tr [ngClass]="{'editable-row': rowIndex == 0}" style="height:67px">
                    <td class="font-bold" style="max-width:1rem">{{ rowIndex == 0 ? 'Index' : 'Cost' }}</td>
                    <td pEditableColumn *ngIf="rowIndex == 1 && editable; else notEditableA1" style="max-width:2.54rem">
                        <p-cellEditor>
                            <ng-template pTemplate="input">
                                <p-inputNumber [(ngModel)]="pyramid.A1" style="width:100%" [inputStyle]="{'width':'100%'}" required mode="decimal" required mode="decimal" [minFractionDigits]="2" [maxFractionDigits]="2" ></p-inputNumber>
                            </ng-template>
                            <ng-template pTemplate="output" >
                                {{ formatNumber(pyramid.A1) }}
                            </ng-template>
                        </p-cellEditor>
                    </td>
                    <ng-template #notEditableA1>
                        <td style="min-width:4.2rem">{{ formatNumber(pyramid.A1) }}</td>
                    </ng-template>
                    <td pEditableColumn *ngIf="rowIndex == 1 && editable; else notEditableA2" style="max-width:2.54rem">
                        <p-cellEditor>
                            <ng-template pTemplate="input">
                                <p-inputNumber [(ngModel)]="pyramid.A2" style="width:100%" [inputStyle]="{'width':'100%'}" required mode="decimal" required mode="decimal" [minFractionDigits]="2" [maxFractionDigits]="2" ></p-inputNumber>
                            </ng-template>
                            <ng-template pTemplate="output">
                                 <td > {{formatNumber(pyramid.A2)}} </td>
                            </ng-template>
                        </p-cellEditor>
                    </td>
                    <ng-template #notEditableA2>
                        <td  style="min-width:4.2rem">{{ formatNumber(pyramid.A2) }}</td>
                    </ng-template>
                    <td pEditableColumn *ngIf="rowIndex == 1 && editable; else notEditableB1" style="max-width:2.54rem">
                        <p-cellEditor>
                            <ng-template pTemplate="input">
                                <p-inputNumber [(ngModel)]="pyramid.B1" style="width:100%" [inputStyle]="{'width':'100%'}" required mode="decimal" required mode="decimal" [minFractionDigits]="2" [maxFractionDigits]="2" ></p-inputNumber>
                            </ng-template>
                            <ng-template pTemplate="output">
                                {{ formatNumber(pyramid.B1)}}
                            </ng-template>
                        </p-cellEditor>
                    </td>
                    <ng-template #notEditableB1>
                        <td  style="min-width:4.2rem">{{ formatNumber(pyramid.B1) }}</td>
                    </ng-template>
                    <td pEditableColumn *ngIf="rowIndex == 1 && editable; else notEditableB2" style="max-width:2.54rem">
                        <p-cellEditor>
                            <ng-template pTemplate="input">
                                <p-inputNumber [(ngModel)]="pyramid.B2" style="width:100%" [inputStyle]="{'width':'100%'}" required mode="decimal" required mode="decimal" [minFractionDigits]="2" [maxFractionDigits]="2" ></p-inputNumber>
                            </ng-template>
                            <ng-template pTemplate="output">
                                {{ formatNumber(pyramid.B2)}}
                            </ng-template>
                        </p-cellEditor>
                    </td>
                    <ng-template #notEditableB2>
                        <td  style="min-width:4.2rem">{{ formatNumber(pyramid.B2) }}</td>
                    </ng-template>
                    <td pEditableColumn *ngIf="rowIndex == 1 && editable; else notEditableB3" style="max-width:2.54rem">
                        <p-cellEditor>
                            <ng-template pTemplate="input">
                                <p-inputNumber [(ngModel)]="pyramid.B3" style="width:100%" [inputStyle]="{'width':'100%'}" required mode="decimal" required mode="decimal" [minFractionDigits]="2" [maxFractionDigits]="2" ></p-inputNumber>
                            </ng-template>
                            <ng-template pTemplate="output">
                                {{ formatNumber(pyramid.B3) }}
                            </ng-template>
                        </p-cellEditor>
                    </td>
                    <ng-template #notEditableB3>
                        <td  style="min-width:4.2rem">{{ formatNumber(pyramid.B3) }}</td>
                    </ng-template>
                    <td pEditableColumn *ngIf="rowIndex == 1 && editable; else notEditableC1" style="max-width:2.54rem">
                        <p-cellEditor>
                            <ng-template pTemplate="input">
                                <p-inputNumber [(ngModel)]="pyramid.C1" style="width:100%" [inputStyle]="{'width':'100%'}" required mode="decimal" required mode="decimal" [minFractionDigits]="2" [maxFractionDigits]="2" ></p-inputNumber>
                            </ng-template>
                            <ng-template pTemplate="output">
                                {{ formatNumber(pyramid.C1) }}
                            </ng-template>
                        </p-cellEditor>
                    </td>
                    <ng-template #notEditableC1>
                        <td  style="min-width:4.2rem">{{ formatNumber(pyramid.C1) }}</td>
                    </ng-template>
                    <td pEditableColumn *ngIf="rowIndex == 1 && editable; else notEditableC2" style="max-width:2.54rem">
                        <p-cellEditor>
                            <ng-template pTemplate="input">
                                <p-inputNumber [(ngModel)]="pyramid.C2" style="width:100%" [inputStyle]="{'width':'100%'}" required mode="decimal" required mode="decimal" [minFractionDigits]="2" [maxFractionDigits]="2" ></p-inputNumber>
                            </ng-template>
                            <ng-template pTemplate="output">
                                {{ formatNumber(pyramid.C2)}}
                            </ng-template>
                        </p-cellEditor>
                    </td>
                    <ng-template #notEditableC2>
                        <td  style="min-width:4.2rem">{{ formatNumber(pyramid.C2) }}</td>
                    </ng-template>
                    <td pEditableColumn *ngIf="rowIndex == 1 && editable; else notEditableC3" style="max-width:2.54rem">
                        <p-cellEditor>
                            <ng-template pTemplate="input">
                                <p-inputNumber [(ngModel)]="pyramid.C3" style="width:100%" [inputStyle]="{'width':'100%'}" required mode="decimal" required mode="decimal" [minFractionDigits]="2" [maxFractionDigits]="2" ></p-inputNumber>
                            </ng-template>
                            <ng-template pTemplate="output">
                                {{ formatNumber(pyramid.C3) }}
                            </ng-template>
                        </p-cellEditor>
                    </td>
                    <ng-template #notEditableC3>
                        <td  style="min-width:4.2rem">{{ formatNumber(pyramid.C3)}}</td>
                    </ng-template>
                    <td pEditableColumn *ngIf="rowIndex == 1 && editable ; else notEditableD1" style="max-width:2.54rem">
                        <p-cellEditor>
                            <ng-template pTemplate="input">
                                <p-inputNumber [(ngModel)]="pyramid.D1" style="width:100%" [inputStyle]="{'width':'100%'}" required mode="decimal" required mode="decimal" [minFractionDigits]="2" [maxFractionDigits]="2" mode="decimal" [minFractionDigits]="2" [maxFractionDigits]="2" ></p-inputNumber>
                            </ng-template>
                            <ng-template pTemplate="output">
                                {{formatNumber(pyramid.D1) }}
                            </ng-template>
                        </p-cellEditor>
                    </td>
                    <ng-template #notEditableD1>
                        <td  style="min-width:4.2rem">{{ formatNumber(pyramid.D1) }}</td>
                    </ng-template>
                    <td pEditableColumn *ngIf="rowIndex == 1 && editable; else notEditableD2" style="max-width:2.54rem">
                        <p-cellEditor>
                            <ng-template pTemplate="input">
                                <p-inputNumber [(ngModel)]="pyramid.D2" style="width:100%" [inputStyle]="{'width':'100%'}" required mode="decimal" required mode="decimal" [minFractionDigits]="2" [maxFractionDigits]="2" ></p-inputNumber>
                            </ng-template>
                            <ng-template pTemplate="output">
                                {{ formatNumber(pyramid.D2) }}
                            </ng-template>
                        </p-cellEditor>
                    </td>
                    <ng-template #notEditableD2>
                        <td style="min-width:4.2rem">{{ formatNumber(pyramid.D2)}}</td>
                    </ng-template>
                </tr>
            </ng-template>
        </p-table>
        <button *ngIf="!editable" style="margin-top:0px !important" pButton pRipple type="button" icon="pi pi-pencil" class="p-button-lg ml-3" pTooltip="Editar" (click)="onEdit()" ></button>
        <div *ngIf="editable" class="flex flex-column flex gap-2 ml-3">
            <button pButton pRipple pTooltip="Cancelar" type="button" icon="pi pi-times" class="p-button-secondary" (click)="onCancel()"></button>
            <button pButton pRipple pTooltip="Guardar" type="button" icon="pi pi-check"  (click)="onSave()"></button>
        </div>
    </div>
    <div class="h-3rem"></div>
    <div class="flex flex-row justify-content-center">
        <div class="flex flex-row gap-3">
            <p-table [value]="countIndexGraphs" responsiveLayout="scroll" class="flex-2" [loading]="loading">
                <ng-template pTemplate="header">
                    <tr>
                        <th>Perfil</th>
                        <th>Count</th>
                        <th>Index</th>
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-countIndex>
                    <tr>
                        <td>{{countIndex.profile}}</td>
                        <td>{{countIndex.count}}</td>
                        <td>{{formatNumber(countIndex.index)}}</td> 
                    </tr>
                </ng-template>
            </p-table>
            <p-chart type="bar" class="flex"[data]="dataCountIndexGraph" [options]="configCountIndexGraph"></p-chart>
        </div>
        <div class="w-6rem"></div>
        <div class="flex flex-row">
            <p-table [value]="countGraphs" responsiveLayout="scroll" class="flex-2 " [loading]="loading">
                <ng-template pTemplate="header">
                    <tr>
                        <th>Perfil</th>
                        <th>Count</th>
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-countGraph>
                    <tr>
                        <td>{{countGraph.profile}} </td>
                        <td>{{countGraph.count}}</td>
                    </tr>
                </ng-template>
            </p-table>
            <div class="flex h-18rem" style="margin-top:8px;">
                <p-chart type="bar" class="flex" [data]="dataCountGraph" [options]="configCountGraph"></p-chart>
            </div>    
        </div>        
    </div>
</div>